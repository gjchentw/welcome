# Implementation Plan: 修正 Welcome 系統效能瓶頸與專案清理

**Branch**: `015-fix-performance-hygiene` | **Date**: 2026-02-16 | **Spec**: [specs/015-fix-performance-hygiene/spec.md](spec.md)
**Input**: Feature specification from `/specs/015-fix-performance-hygiene/spec.md`

**Note**: This template is filled in by the `/speckit.plan` command. See `.specify/templates/commands/plan.md` for the execution workflow.

## Summary

本計畫旨在解決 `v1.1.1` 中存在的效能風險。核心工作包含重構 `PlayerCacheManager` 以支援 UUID 快取，優化 `LoginAttemptListener` 在 `AsyncPlayerPreLoginEvent` 期間的資料存取，並移除 `WelcomeCommand` 中會導致主執行緒阻塞的同步 API 呼叫。同時，將執行專案目錄清理，移除過時的 `013` 規格文件並精簡代碼結構。

## 技術背景 (Technical Context)

**Spigot/Paper 版本**: 1.21.4 (基於 build.gradle 配置)
**JDK 版本**: **Java 25 (必須/Required)**
**Testing**: **JUnit 5** (透過 Gradle 執行)
**主要相依性 (Dependencies)**: Spigot API, MockBukkit (用於測試)
**資料儲存 (Storage)**: 記憶體快取 (Map<String, UUID>)
**設定檔 (Configuration)**: config.yml
**指令結構 (Commands)**: /welcome <player>
**權限節點 (Permissions)**: welcome.use
**效能目標**: 確保 `/welcome` 指令在任何情況下都不會阻塞伺服器主執行緒。

## 憲法檢查 (Constitution Check)

*必要關卡：必須在 Phase 0 研究前通過。Phase 1 設計後重新檢查。*

*   [x] **非同步優先**: 已識別 `Bukkit.getOfflinePlayer(String)` 為潛在阻塞點，計畫改用快取 UUID 或非同步方式。
*   [x] **配置驅動**: 現有訊息與開關已透過 config 驅動，本次變更不影響此原則。
*   [x] **權限控管**: 指令權限維持不變，確保安全性。
*   [x] **資源生命週期**: `PlayerCacheManager` 的資源管理將隨插件啟閉正確處理。
*   [x] **核心邏輯可測試**: 計畫更新單元測試，模擬離線玩家查詢以驗證非阻塞行為。
*   [x] **文件完整性**: 將檢查 README.md 是否需要因效能重構而更新說明。
*   [x] **CI/CD 設定**: GitHub Actions 將驗證重構後的代碼建置與測試。
*   [x] **規格驅動**: 嚴格遵循 Spec-Kit 流程。

## Project Structure

### Documentation (this feature)

```text
specs/015-fix-performance-hygiene/
├── plan.md              # This file
├── research.md          # Phase 0 output
├── data-model.md        # Phase 1 output
├── quickstart.md        # Phase 1 output
├── contracts/           # Phase 1 output
└── tasks.md             # Phase 2 output (generated by /speckit.tasks)
```

### 專案結構 (Project Structure)

```text
src/main/java/com/welcome/
├── commands/             # WelcomeCommand
├── listeners/            # LoginAttemptListener
├── managers/             # PlayerCacheManager (重構重點)
└── Welcome.java          # 主要類別

tests/                    # 單元測試 (驗證效能優化)
```

**結構決策**: 沿用現有套件結構，專注於 `managers` 與 `listeners` 的重構。

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

*(無憲法違規項目)*
